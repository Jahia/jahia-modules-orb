description: >
  Cancel a release

parameters:
  primary_release_branch:
    type: string
    default: "main"
    description: "Name of the primary release branch (master, main, ...)"
  module_id:
    type: string
    description: "ID of the module"
  github_slug:
    type: string
    description: "GitHub SLUG of the module (for example: jahia/sandbox)"
  resource_class:
    type: string
    default: "large"
    description: "CircleCI resource_class (small, medium, large, xlarge, ...)"
  working_directory:
    type: string
    default: "~/spource"
    description: "Working directory for the job"  

working_directory: << parameters.working_directory >>

resource_class: << parameters.resource_class >>

docker:
  - image: cimg/openjdk:8.0.275-node
    
steps:
  - attach_workspace:
      at: .
  - checkout
  - jahia-modules-orb/generate-cachekey-seed:
      working_directory: << parameters.working_directory >>
  - restore_cache:
      keys:
        - v1-maven-dependencies-{{ checksum "maven_cache_seed" }}
        # fallback to using the latest cache if no exact match is found
        - v1-maven-dependencies-
  - restore_cache:
      keys:
        - v2-sonar-owasp-dependencies-{{ checksum "is_pr" }}
        - v2-sonar-owasp-dependencies-      
  - jahia-modules-orb/sonar-analysis:
      github_slug: << parameters.github_slug >>
      module_id: << parameters.module_id >>
      primary_release_branch: << parameters.primary_release_branch >>
  - save_cache:
      paths:
        - ~/.owasp/dependency-check-data
        - ~/.sonar/cache
      key: v2-sonar-owasp-dependencies-{{ checksum "is_pr" }}      
